<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UFC Live Tracker</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .fighter-record {
            color: #cccccc;
            font-size: 0.9rem;
            margin-top: 0.2rem;
        }

        .fighter-nationality {
            color: #f57c00;
            font-size: 0.8rem;
            margin-top: 0.3rem;
            font-style: italic;
        }

        .fighter-weight-class {
            color: #d32f2f;
            font-size: 0.8rem;
            margin-top: 0.2rem;
            font-weight: bold;
        }

        .fight-item .fighter-record {
            color: #999;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }

        .fighters {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .fighters {
                flex-direction: column;
                text-align: center;
                gap: 0.2rem;
            }

            .fighter-record {
                font-size: 0.8rem;
            }
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a1f2e 50%, #2d1b2e 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            border-bottom: 2px solid #d32f2f;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: #d32f2f;
        }

        .ufc-logo {
            width: 40px;
            height: 24px;
            background: #d32f2f;
            position: relative;
            font-family: 'Arial Black', Arial, sans-serif;
            font-weight: 900;
            font-size: 14px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 2px;
            letter-spacing: -1px;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .nav-menu a {
            color: #ffffff;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .nav-menu a:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.9rem;
        }

        .user-badge {
            background: #d32f2f;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        /* Main Content */
        .main-content {
            margin-top: 80px;
            padding: 2rem;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Auth Modal */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .auth-container {
            background: linear-gradient(145deg, #1a1f2e, #2d1b2e);
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 450px;
            margin: 1rem;
            border: 1px solid #d32f2f;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-header h2 {
            color: #d32f2f;
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #cccccc;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #404040;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #d32f2f;
            box-shadow: 0 0 10px rgba(211, 47, 47, 0.3);
        }

        .auth-button {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(45deg, #d32f2f, #f57c00);
            border: none;
            border-radius: 8px;
            color: #ffffff;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .auth-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(211, 47, 47, 0.3);
        }

        .auth-switch {
            text-align: center;
            color: #cccccc;
        }

        .auth-switch a {
            color: #d32f2f;
            cursor: pointer;
            text-decoration: none;
        }

        /* Dashboard */
        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .dashboard-header h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, #d32f2f, #f57c00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .dashboard-header p {
            font-size: 1.2rem;
            color: #cccccc;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: linear-gradient(145deg, #1a1f2e, #2d1b2e);
            padding: 2rem;
            border-radius: 15px;
            border: 1px solid #404040;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: #d32f2f;
            box-shadow: 0 10px 30px rgba(211, 47, 47, 0.2);
        }

        .stat-card .icon {
            font-size: 3rem;
            color: #d32f2f;
            margin-bottom: 1rem;
        }

        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .stat-card p {
            color: #cccccc;
        }

        /* Events Section */
        .events-section {
            margin-bottom: 3rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .section-header h2 {
            font-size: 2rem;
            color: #d32f2f;
        }

        .btn {
            padding: 0.8rem 1.5rem;
            background: linear-gradient(45deg, #d32f2f, #f57c00);
            border: none;
            border-radius: 8px;
            color: #ffffff;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(211, 47, 47, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #404040, #606060);
        }

        /* Events Grid */
        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
        }

        .event-card {
            background: linear-gradient(145deg, #1a1f2e, #2d1b2e);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid #404040;
            transition: all 0.3s ease;
        }

        .event-card:hover {
            transform: translateY(-5px);
            border-color: #d32f2f;
            box-shadow: 0 15px 35px rgba(211, 47, 47, 0.2);
        }

        .event-header {
            background: linear-gradient(45deg, #d32f2f, #f57c00);
            padding: 1.5rem;
            text-align: center;
        }

        .event-header h3 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
        }

        .event-date {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .event-body {
            padding: 1.5rem;
        }

        .event-location {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            color: #cccccc;
        }

        .fights-preview {
            margin-bottom: 1.5rem;
        }

        .fights-preview h4 {
            color: #d32f2f;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .fight-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem;
            background: rgba(211, 47, 47, 0.1);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border-left: 3px solid #d32f2f;
        }

        .fighters {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .fighter {
            font-weight: 500;
        }

        .vs {
            color: #d32f2f;
            font-weight: bold;
        }

        .fight-status {
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-live {
            background: #4caf50;
        }

        .status-upcoming {
            background: #ff9800;
        }

        .status-finished {
            background: #757575;
        }

        .event-actions {
            display: flex;
            gap: 1rem;
        }

        .event-actions .btn {
            flex: 1;
            justify-content: center;
        }

        /* Live Fight View */
        .live-fight {
            display: none;
            padding: 2rem;
        }

        .live-fight.active {
            display: block;
        }

        .fight-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: linear-gradient(145deg, #1a1f2e, #2d1b2e);
            border-radius: 15px;
            border: 2px solid #d32f2f;
        }

        .fight-title {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #d32f2f, #f57c00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .fighters-vs {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 3rem;
            margin: 2rem 0;
        }

        .fighter-card {
            text-align: center;
            flex: 1;
            max-width: 200px;
        }

        .fighter-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(45deg, #d32f2f, #f57c00);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 2rem;
        }

        .fighter-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .fighter-record {
            color: #cccccc;
            font-size: 0.9rem;
        }

        .vs-separator {
            font-size: 3rem;
            color: #d32f2f;
            font-weight: bold;
        }

        /* Live Stats */
        .live-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .stats-panel {
            background: linear-gradient(145deg, #1a1f2e, #2d1b2e);
            padding: 2rem;
            border-radius: 15px;
            border: 1px solid #404040;
        }

        .stats-panel h3 {
            color: #d32f2f;
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
            text-align: center;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 0;
            border-bottom: 1px solid #404040;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #cccccc;
        }

        .stat-values {
            display: flex;
            gap: 1rem;
            font-weight: bold;
        }

        .stat-blue {
            color: #2196f3;
        }

        .stat-red {
            color: #d32f2f;
        }

        /* Probability Panel */
        .probability-panel {
            background: linear-gradient(145deg, #1a1f2e, #2d1b2e);
            padding: 2rem;
            border-radius: 15px;
            border: 1px solid #404040;
            text-align: center;
        }

        .probability-chart {
            display: flex;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
            background: #404040;
        }

        .prob-blue {
            background: #2196f3;
            transition: width 0.5s ease;
        }

        .prob-red {
            background: #d32f2f;
            transition: width 0.5s ease;
        }

        .prob-values {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }

            .nav-menu {
                display: none;
            }

            .dashboard-header h1 {
                font-size: 2rem;
            }

            .fighters-vs {
                flex-direction: column;
                gap: 1rem;
            }

            .vs-separator {
                transform: rotate(90deg);
            }

            .live-stats {
                grid-template-columns: 1fr;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #404040;
            border-radius: 50%;
            border-top-color: #d32f2f;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 100px;
            right: 20px;
            background: #d32f2f;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 3000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background: #4caf50;
        }

        .toast.error {
            background: #f44336;
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }

        .event-modal {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .event-modal .fight-detail-item {
            transition: all 0.3s ease;
        }

        .event-modal .fight-detail-item:hover {
            transform: translateX(5px);
            background: rgba(211, 47, 47, 0.2) !important;
        }

        /* Estado de peleas mejorado */
        .fight-status {
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-live {
            background: linear-gradient(45deg, #4caf50, #66bb6a);
            animation: pulse 2s infinite;
        }

        .status-upcoming {
            background: linear-gradient(45deg, #ff9800, #ffb74d);
        }

        .status-finished {
            background: linear-gradient(45deg, #757575, #9e9e9e);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
        }

        /* Mensaje de no hay peleas en vivo */
        .no-live-fights {
            animation: slideInDown 0.5s ease;
        }

        @keyframes slideInDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Mejoras para las tarjetas de eventos */
        .event-card .fights-preview {
            max-height: 300px;
            overflow-y: auto;
        }

        .event-card .fights-preview::-webkit-scrollbar {
            width: 4px;
        }

        .event-card .fights-preview::-webkit-scrollbar-track {
            background: #404040;
            border-radius: 2px;
        }

        .event-card .fights-preview::-webkit-scrollbar-thumb {
            background: #d32f2f;
            border-radius: 2px;
        }

        /* Loading state mejorado */
        .loading-events {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            padding: 3rem;
            color: #cccccc;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #404040;
            border-top: 4px solid #d32f2f;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Responsivo para el modal de evento */
        @media (max-width: 768px) {
            .event-modal {
                padding: 1rem;
            }

            .event-modal > div {
                max-height: 90vh;
                border-radius: 15px;
            }

            .fight-detail-item .fighters {
                flex-direction: column;
                text-align: center;
                gap: 0.5rem;
            }

            .fight-detail-item .fighters > div:first-child,
            .fight-detail-item .fighters > div:last-child {
                text-align: center;
            }
        }

        /* Mejoras para el contador de peleas */
        .fights-preview h4 {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .fight-count-badge {
            background: rgba(211, 47, 47, 0.2);
            color: #d32f2f;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: normal;
        }

        /* Animación para actualizar datos */
        .updating {
            animation: updating 0.5s ease;
        }

        @keyframes updating {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
<!-- Header -->
<header class="header">
    <div class="nav-container">
        <div class="logo">
            <div class="ufc-logo">UFC</div>
            Live Tracker
        </div>
        <nav class="nav-menu" id="navMenu">
            <li><a href="#" onclick="showDashboard()"><i class="fas fa-home"></i> Dashboard</a></li>
            <li><a href="#" onclick="showEvents()"><i class="fas fa-calendar"></i> Eventos</a></li>
            <li><a href="#" onclick="showFights()"><i class="fas fa-fire"></i> Peleas En Vivo</a></li>
        </nav>
        <div class="user-info" id="userInfo">
            <span id="userName"></span>
            <span class="user-badge" id="userRole"></span>
            <button onclick="logout()" class="btn btn-secondary">
                <i class="fas fa-sign-out-alt"></i> Salir
            </button>
        </div>
    </div>
</header>

<!-- Auth Modal -->
<div class="auth-modal" id="authModal">
    <div class="auth-container">
        <div class="auth-header">
            <h2><div class="ufc-logo">UFC</div> Live Tracker</h2>
            <p>Seguimiento en tiempo real de peleas UFC</p>
        </div>

        <!-- Login Form -->
        <form id="loginForm">
            <div class="form-group">
                <label for="loginEmail">Email</label>
                <input type="email" id="loginEmail" required>
            </div>
            <div class="form-group">
                <label for="loginPassword">Contraseña</label>
                <input type="password" id="loginPassword" required>
            </div>
            <button type="submit" class="auth-button">
                <span id="loginButtonText">Iniciar Sesión</span>
                <div class="loading hidden" id="loginLoading"></div>
            </button>
        </form>

        <!-- Register Form -->
        <form id="registerForm" class="hidden">
            <div class="form-group">
                <label for="registerName">Nombre</label>
                <input type="text" id="registerName" required>
            </div>
            <div class="form-group">
                <label for="registerEmail">Email</label>
                <input type="email" id="registerEmail" required>
            </div>
            <div class="form-group">
                <label for="registerPassword">Contraseña</label>
                <input type="password" id="registerPassword" required>
            </div>
            <button type="submit" class="auth-button">
                <span id="registerButtonText">Registrarse</span>
                <div class="loading hidden" id="registerLoading"></div>
            </button>
        </form>

        <div class="auth-switch">
            <span id="authSwitchText">¿No tienes cuenta?</span>
            <a href="#" id="authSwitchLink" onclick="toggleAuthMode()">Regístrate aquí</a>
        </div>
    </div>
</div>

<!-- Main Content -->
<main class="main-content">
    <!-- Dashboard -->
    <div class="dashboard active" id="dashboard">
        <div class="dashboard-header">
            <h1>🥊 UFC Live Tracker</h1>
            <p>Tu plataforma definitiva para seguimiento en tiempo real de peleas y eventos UFC</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="icon"><i class="fas fa-calendar-alt"></i></div>
                <h3 id="totalEvents">-</h3>
                <p>Eventos Totales</p>
            </div>
            <div class="stat-card">
                <div class="icon"><i class="fas fa-fire"></i></div>
                <h3 id="liveFights">-</h3>
                <p>Peleas En Vivo</p>
            </div>
            <div class="stat-card">
                <div class="icon"><i class="fas fa-users"></i></div>
                <h3 id="totalFighters">-</h3>
                <p>Luchadores</p>
            </div>
            <div class="stat-card">
                <div class="icon"><i class="fas fa-trophy"></i></div>
                <h3 id="completedFights">-</h3>
                <p>Peleas Finalizadas</p>
            </div>
        </div>

        <div class="events-section">
            <div class="section-header">
                <h2><i class="fas fa-calendar"></i> Próximos Eventos</h2>
                <div>
                    <button class="btn" onclick="refreshData()">
                        <i class="fas fa-sync-alt"></i> Actualizar
                    </button>
                    <button class="btn" onclick="createEvent()">
                        <i class="fas fa-plus"></i> Crear Evento
                    </button>
                </div>
            </div>
            <div class="events-grid" id="eventsGrid">
                <!-- Events will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Live Fight View -->
    <div class="live-fight" id="liveFight">
        <div class="fight-header">
            <button class="btn btn-secondary" onclick="showDashboard()" style="float: left;">
                <i class="fas fa-arrow-left"></i> Volver
            </button>
            <div class="fight-title">UFC 300 - Pelea Principal</div>
            <div class="fighters-vs">
                <div class="fighter-card">
                    <div class="fighter-avatar"> <img src="https://ssl.gstatic.com/onebox/media/sports/photos/ufc/3605_H-bQHA_96x96.png" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                    </div>
                    <div class="fighter-name">Luchador Azul</div>
                    <div class="fighter-record" id="fighterRecord1">Cargando...</div>
                </div>
                <div class="vs-separator">VS</div>
                <div class="fighter-card">
                    <div class="fighter-avatar"> <img src="https://ssl.gstatic.com/onebox/media/sports/photos/ufc/1531_bqT22g_96x96.png" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                    </div>
                    <div class="fighter-name">Luchador Rojo</div>
                    <div class="fighter-record" id="fighterRecord2">Cargando...</div>
                </div>
            </div>
            <div style="text-align: center; margin-top: 1rem;">
                <span class="fight-status status-live">🔴 EN VIVO - Round 2</span>
            </div>
        </div>

        <div class="live-stats">
            <div class="stats-panel">
                <h3>📊 Estadísticas del Round</h3>
                <div class="stat-row">
                    <span class="stat-label">Golpes Conectados</span>
                    <div class="stat-values">
                        <span class="stat-blue">20</span>
                        <span class="stat-red">7</span>
                    </div>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Derribos</span>
                    <div class="stat-values">
                        <span class="stat-blue">7</span>
                        <span class="stat-red">3</span>
                    </div>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Control de Jaula</span>
                    <div class="stat-values">
                        <span class="stat-blue">3:45</span>
                        <span class="stat-red">1:15</span>
                    </div>
                </div>
            </div>

            <div class="probability-panel">
                <h3>🎯 Probabilidades de Victoria</h3>
                <div class="probability-chart">
                    <div class="prob-blue" style="width: 75%;"></div>
                    <div class="prob-red" style="width: 25%;"></div>
                </div>
                <div class="prob-values">
                    <span class="stat-blue">75%</span>
                    <span class="stat-red">25%</span>
                </div>
                <p style="color: #cccccc; margin-top: 1rem; font-size: 0.9rem;">
                    Actualizado hace 5 segundos
                </p>
            </div>
        </div>
    </div>
</main>

<script>
    // Global state
    let currentUser = null;
    let isLoginMode = true;
    const API_BASE = 'http://localhost:8080/api';

    // Initialize app
    document.addEventListener('DOMContentLoaded', function() {
        checkAuthStatus();
        setupEventListeners();
    });

    async function loadFightersForEvent(eventoId) {
        try {
            const response = await fetch(`${API_BASE}/luchadores`, {
                headers: {
                    'Authorization': `Basic ${currentUser.credentials}`,
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                const luchadores = await response.json();

                // Buscar luchadores específicos para mostrar en la vista en vivo
                const topuria = luchadores.find(l => l.nombre === 'Ilia Topuria');
                const oliveira = luchadores.find(l => l.nombre === 'Charles Oliveira');

                if (topuria && oliveira) {
                    updateFighterDisplay('blue', topuria);
                    updateFighterDisplay('red', oliveira);
                }
            }
        } catch (error) {
            console.error('Error cargando luchadores:', error);
        }
    }

    // FUNCIÓN PARA ACTUALIZAR LA INFORMACIÓN DE UN LUCHADOR EN LA UI
    function updateFighterDisplay(corner, fighter) {
        const fighterCard = document.querySelector(`.fighter-card.${corner}`);
        if (fighterCard) {
            // Actualizar nombre
            const nameElement = fighterCard.querySelector('.fighter-name');
            if (nameElement) {
                nameElement.textContent = fighter.nombre;
            }

            // Actualizar historial
            const recordElement = fighterCard.querySelector('.fighter-record');
            if (recordElement) {
                recordElement.textContent = fighter.historial || 'N/A';
            }

            // Actualizar nacionalidad si existe
            const nationalityElement = fighterCard.querySelector('.fighter-nationality');
            if (nationalityElement) {
                nationalityElement.textContent = fighter.nacionalidad || '';
            }

            // Actualizar categoría de peso si existe
            const weightClassElement = fighterCard.querySelector('.fighter-weight-class');
            if (weightClassElement) {
                weightClassElement.textContent = fighter.categoriaPeso || '';
            }
        }
    }

    // ACTUALIZAR LA FUNCIÓN showFights PARA CARGAR DATOS REALES
    async function showFights() {
        hideAllViews();
        document.getElementById('liveFight').classList.add('active');

        try {
            // Usar el nuevo endpoint específico para peleas en vivo
            const response = await fetch(`${API_BASE}/peleas/live`, {
                headers: {
                    'Authorization': `Basic ${currentUser.credentials}`,
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                const peleasEnVivo = await response.json();

                if (peleasEnVivo.length === 0) {
                    // No hay peleas en vivo - mostrar mensaje
                    showNoLiveFightsMessage();
                    return;
                }

                // Hay peleas en vivo - cargar la primera
                const pelea = peleasEnVivo[0];
                await displayFightInfo(pelea);

                // Conectar WebSocket solo si hay peleas en vivo
                if (!liveWebSocket) {
                    liveWebSocket = new LiveFightWebSocket();
                }
                liveWebSocket.connect();
            } else {
                throw new Error('Error cargando peleas en vivo');
            }
        } catch (error) {
            console.error('Error cargando peleas en vivo:', error);
            showNoLiveFightsMessage();
        }
    }

    async function renderEventsWithFighters(eventos) {
        const eventsGrid = document.getElementById('eventsGrid');

        if (eventos.length === 0) {
            eventsGrid.innerHTML = `
            <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #cccccc;">
                <i class="fas fa-calendar-times" style="font-size: 3rem; margin-bottom: 1rem; color: #666;"></i>
                <h3>No hay eventos disponibles</h3>
                <p>Crea tu primer evento para comenzar</p>
                ${currentUser.rol === 'admin' ? `
                    <button class="btn" onclick="createEvent()" style="margin-top: 1rem;">
                        <i class="fas fa-plus"></i> Crear Evento
                    </button>
                ` : ''}
            </div>
        `;
            return;
        }

        // Cargar luchadores para mostrar nombres
        let luchadores = [];
        try {
            const response = await fetch(`${API_BASE}/luchadores`, {
                headers: {
                    'Authorization': `Basic ${currentUser.credentials}`,
                    'Content-Type': 'application/json'
                }
            });
            if (response.ok) {
                luchadores = await response.json();
            }
        } catch (error) {
            console.error('Error cargando luchadores:', error);
        }

        // Mostrar mensaje de carga
        eventsGrid.innerHTML = `
        <div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: #cccccc;">
            <div class="loading" style="margin: 0 auto 1rem;"></div>
            <p>Cargando peleas de los eventos...</p>
        </div>
    `;

        // Cargar peleas para cada evento usando el nuevo endpoint
        const eventosConPeleas = await Promise.all(
            eventos.map(async (evento) => {
                try {
                    const peleasDelEvento = await loadFightsForEvent(evento.id);
                    return { ...evento, peleas: peleasDelEvento };
                } catch (error) {
                    console.error(`Error cargando peleas para evento ${evento.id}:`, error);
                    return { ...evento, peleas: [] };
                }
            })
        );

        eventsGrid.innerHTML = eventosConPeleas.map(evento => {
            const peleasHTML = evento.peleas.length > 0
                ? evento.peleas.slice(0, 3).map(pelea => {
                    const luchadorAzul = luchadores.find(l => l.id === pelea.luchadorAzulId);
                    const luchadorRojo = luchadores.find(l => l.id === pelea.luchadorRojoId);

                    return `
                    <div class="fight-item">
                        <div class="fighters">
                            <span class="fighter">${luchadorAzul ? luchadorAzul.nombre : 'Luchador TBD'}</span>
                            ${luchadorAzul && luchadorAzul.historial ?
                        `<span class="fighter-record">(${luchadorAzul.historial})</span>` : ''}
                            <span class="vs">VS</span>
                            <span class="fighter">${luchadorRojo ? luchadorRojo.nombre : 'Luchador TBD'}</span>
                            ${luchadorRojo && luchadorRojo.historial ?
                        `<span class="fighter-record">(${luchadorRojo.historial})</span>` : ''}
                        </div>
                        <span class="fight-status ${getFightStatusClass(pelea)}">
                            ${getFightStatusText(pelea)}
                        </span>
                    </div>
                `;
                }).join('')
                : `
                <div class="fight-item">
                    <div class="fighters">
                        <span class="fighter">No hay peleas programadas</span>
                    </div>
                    <span class="fight-status status-upcoming">Por definir</span>
                </div>
            `;

            const peleasInfo = evento.peleas.length > 0
                ? `${evento.peleas.length} pelea${evento.peleas.length !== 1 ? 's' : ''}`
                : 'Sin peleas';

            return `
            <div class="event-card">
                <div class="event-header">
                    <h3>${evento.nombre}</h3>
                    <div class="event-date">
                        <i class="fas fa-calendar"></i>
                        ${formatDate(evento.fecha)}
                    </div>
                </div>
                <div class="event-body">
                    <div class="event-location">
                        <i class="fas fa-map-marker-alt"></i>
                        ${evento.ubicacion || 'Ubicación por definir'}
                    </div>
                    <div class="fights-preview">
                        <h4><i class="fas fa-fist-raised"></i> Peleas (${peleasInfo})</h4>
                        ${peleasHTML}
                        ${evento.peleas.length > 3 ?
                `<div style="text-align: center; margin-top: 1rem; color: #d32f2f; font-size: 0.9rem;">
                                <i class="fas fa-plus-circle"></i> ${evento.peleas.length - 3} peleas más
                            </div>` : ''}
                    </div>
                    <div class="event-actions">
                        <button class="btn" onclick="viewEvent(${evento.id})">
                            <i class="fas fa-eye"></i> Ver Evento
                        </button>
                        ${currentUser.rol === 'admin' ?
                `<button class="btn btn-secondary" onclick="editEvent(${evento.id})">
                                <i class="fas fa-edit"></i> Editar
                            </button>` : ''}
                    </div>
                </div>
            </div>
        `;
        }).join('');
    }

        function getFightStatusClass(pelea) {
            if (pelea.finalizada) {
                return 'status-finished';
            }

            const fightDate = new Date(pelea.fecha);
            const now = new Date();

            if (fightDate <= now) {
                return 'status-live';
            }

            return 'status-upcoming';
        }

        function getFightStatusText(pelea) {
            if (pelea.finalizada) {
                return 'Finalizada';
            }

            const fightDate = new Date(pelea.fecha);
            const now = new Date();

            if (fightDate <= now) {
                return '🔴 En Vivo';
            }

            return 'Próximamente';
        }

    async function viewEvent(eventId) {
        try {
            // Cargar información del evento
            const eventoResponse = await fetch(`${API_BASE}/eventos/${eventId}`, {
                headers: {
                    'Authorization': `Basic ${currentUser.credentials}`,
                    'Content-Type': 'application/json'
                }
            });

            if (!eventoResponse.ok) {
                throw new Error('Error cargando evento');
            }

            const evento = await eventoResponse.json();

            // Cargar peleas del evento
            const peleas = await loadFightsForEvent(eventId);

            // Cargar información de luchadores
            const luchadoresResponse = await fetch(`${API_BASE}/luchadores`, {
                headers: {
                    'Authorization': `Basic ${currentUser.credentials}`,
                    'Content-Type': 'application/json'
                }
            });

            const luchadores = luchadoresResponse.ok ? await luchadoresResponse.json() : [];

            // Mostrar modal o nueva vista con detalles del evento
            showEventDetails(evento, peleas, luchadores);

        } catch (error) {
            console.error('Error cargando detalles del evento:', error);
            showToast('Error cargando detalles del evento', 'error');
        }
    }

    function showEventDetails(evento, peleas, luchadores) {
        const modal = document.createElement('div');
        modal.className = 'event-modal';
        modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 3000;
        padding: 2rem;
    `;

        const peleasHTML = peleas.length > 0
            ? peleas.map(pelea => {
                const luchadorAzul = luchadores.find(l => l.id === pelea.luchadorAzulId);
                const luchadorRojo = luchadores.find(l => l.id === pelea.luchadorRojoId);

                return `
                <div class="fight-detail-item" style="background: rgba(211, 47, 47, 0.1); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 3px solid #d32f2f;">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                        <div class="fighters" style="display: flex; align-items: center; gap: 1rem; flex: 1;">
                            <div style="text-align: center;">
                                <div style="font-weight: bold; color: #2196f3;">${luchadorAzul ? luchadorAzul.nombre : 'TBD'}</div>
                                ${luchadorAzul ? `
                                    <div style="font-size: 0.8rem; color: #ccc;">${luchadorAzul.nacionalidad || ''}</div>
                                    <div style="font-size: 0.8rem; color: #ccc;">${luchadorAzul.historial || ''}</div>
                                ` : ''}
                            </div>
                            <div style="font-size: 1.5rem; color: #d32f2f; font-weight: bold;">VS</div>
                            <div style="text-align: center;">
                                <div style="font-weight: bold; color: #d32f2f;">${luchadorRojo ? luchadorRojo.nombre : 'TBD'}</div>
                                ${luchadorRojo ? `
                                    <div style="font-size: 0.8rem; color: #ccc;">${luchadorRojo.nacionalidad || ''}</div>
                                    <div style="font-size: 0.8rem; color: #ccc;">${luchadorRojo.historial || ''}</div>
                                ` : ''}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="fight-status ${getFightStatusClass(pelea)}" style="padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem; font-weight: bold; margin-bottom: 0.5rem;">
                                ${getFightStatusText(pelea)}
                            </div>
                            <div style="font-size: 0.8rem; color: #ccc;">
                                ${formatDateTime(pelea.fecha)}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            }).join('')
            : '<p style="text-align: center; color: #ccc; padding: 2rem;">No hay peleas programadas para este evento</p>';

        modal.innerHTML = `
        <div style="background: linear-gradient(145deg, #1a1f2e, #2d1b2e); border-radius: 20px; max-width: 800px; width: 100%; max-height: 80vh; overflow-y: auto; border: 2px solid #d32f2f;">
            <div style="background: linear-gradient(45deg, #d32f2f, #f57c00); padding: 2rem; text-align: center; border-radius: 18px 18px 0 0;">
                <h2 style="margin: 0; font-size: 2rem;">${evento.nombre}</h2>
                <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">
                    <i class="fas fa-calendar"></i> ${formatDate(evento.fecha)} |
                    <i class="fas fa-map-marker-alt"></i> ${evento.ubicacion || 'Ubicación por definir'}
                </p>
            </div>
            <div style="padding: 2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h3 style="color: #d32f2f; margin: 0;"><i class="fas fa-fist-raised"></i> Peleas Programadas (${peleas.length})</h3>
                    <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: #666; border: none; color: white; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-times"></i> Cerrar
                    </button>
                </div>
                <div class="fights-list">
                    ${peleasHTML}
                </div>
                ${currentUser.rol === 'admin' ? `
                    <div style="text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #404040;">
                        <button class="btn" onclick="addFightToEvent(${evento.id})" style="margin-right: 1rem;">
                            <i class="fas fa-plus"></i> Agregar Pelea
                        </button>
                        <button class="btn btn-secondary" onclick="editEvent(${evento.id})">
                            <i class="fas fa-edit"></i> Editar Evento
                        </button>
                    </div>
                ` : ''}
            </div>
        </div>
    `;

        document.body.appendChild(modal);

        // Cerrar modal al hacer clic fuera
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.remove();
            }
        });
    }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('es-ES', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

    function addFightToEvent(eventoId) {
        if (currentUser.rol !== 'admin') {
            showToast('Solo los administradores pueden agregar peleas', 'error');
            return;
        }

        // Aquí podrías abrir un modal para crear una nueva pelea
        showToast(`Función para agregar pelea al evento ${eventoId} - En desarrollo`, 'success');
    }



        // FUNCIÓN HELPER PARA OBTENER LUCHADORES DEL MAIN EVENT
    function getMainEventFighters(eventoId, luchadores) {
        // Para UFC 317, buscar Topuria vs Oliveira
        const topuria = luchadores.find(l => l.nombre === 'Ilia Topuria');
        const oliveira = luchadores.find(l => l.nombre === 'Charles Oliveira');

        if (topuria && oliveira) {
            return {
                fighter1: topuria,
                fighter2: oliveira
            };
        }

        // Para otros eventos, tomar los primeros dos luchadores disponibles
        if (luchadores.length >= 2) {
            return {
                fighter1: luchadores[0],
                fighter2: luchadores[1]
            };
        }

        return null;
    }

    // ACTUALIZAR LA FUNCIÓN loadEvents PARA USAR LA NUEVA FUNCIÓN
    async function loadEvents() {
        try {
            const response = await fetch(`${API_BASE}/eventos`, {
                headers: {
                    'Authorization': `Basic ${currentUser.credentials}`,
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                const eventos = await response.json();
                document.getElementById('totalEvents').textContent = eventos.length;

                // Usar la función actualizada que carga peleas reales
                await renderEventsWithFighters(eventos);
            } else {
                throw new Error('Error cargando eventos');
            }
        } catch (error) {
            console.error('Error loading events:', error);
            document.getElementById('totalEvents').textContent = '0';
            await renderEventsWithFighters([]);
        }
    }

    function setupEventListeners() {
        // Auth forms
        document.getElementById('loginForm').addEventListener('submit', handleLogin);
        document.getElementById('registerForm').addEventListener('submit', handleRegister);
    }

    function checkAuthStatus() {
        const savedUser = localStorage.getItem('currentUser');
        if (savedUser) {
            currentUser = JSON.parse(savedUser);
            showApp();
            loadDashboardData();
        } else {
            showAuthModal();
        }
    }

    function showAuthModal() {
        document.getElementById('authModal').style.display = 'flex';
    }

    function hideAuthModal() {
        document.getElementById('authModal').style.display = 'none';
    }

    function showApp() {
        hideAuthModal();
        updateUserInfo();
        showDashboard();
    }

    function updateUserInfo() {
        if (currentUser) {
            document.getElementById('userName').textContent = currentUser.nombre;
            document.getElementById('userRole').textContent = currentUser.rol.toUpperCase();
            document.getElementById('navMenu').style.display = 'flex';
            document.getElementById('userInfo').style.display = 'flex';
        }
    }

    function toggleAuthMode() {
        isLoginMode = !isLoginMode;
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const switchText = document.getElementById('authSwitchText');
        const switchLink = document.getElementById('authSwitchLink');

        if (isLoginMode) {
            loginForm.classList.remove('hidden');
            registerForm.classList.add('hidden');
            switchText.textContent = '¿No tienes cuenta?';
            switchLink.textContent = 'Regístrate aquí';
        } else {
            loginForm.classList.add('hidden');
            registerForm.classList.remove('hidden');
            switchText.textContent = '¿Ya tienes cuenta?';
            switchLink.textContent = 'Inicia sesión aquí';
        }
    }

    async function handleLogin(e) {
        e.preventDefault();

        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;

        setLoadingState('login', true);

        try {
            // Primero intentar el endpoint de autenticación
            const response = await fetch(`${API_BASE}/auth/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, password })
            });

            if (response.ok) {
                const userData = await response.json();

                // Guardar usuario con credenciales para futuros requests
                currentUser = {
                    ...userData,
                    credentials: btoa(`${email}:${password}`)
                };

                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showToast('¡Inicio de sesión exitoso!', 'success');
                showApp();
            } else {
                const error = await response.json();
                throw new Error(error.error || 'Credenciales inválidas');
            }
        } catch (error) {
            showToast(error.message || 'Error de inicio de sesión', 'error');
        } finally {
            setLoadingState('login', false);
        }
    }

    async function handleRegister(e) {
        e.preventDefault();

        const name = document.getElementById('registerName').value;
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;

        setLoadingState('register', true);

        try {
            const response = await fetch(`${API_BASE}/usuarios`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    nombre: name,
                    correo: email,
                    password: password
                })
            });

            if (response.ok) {
                const result = await response.json();
                showToast('¡Registro exitoso! Revisa tu email para la confirmación.', 'success');

                // Switch to login form
                toggleAuthMode();

                // Pre-fill login email
                document.getElementById('loginEmail').value = email;
            } else {
                const error = await response.json();
                throw new Error(error.error || 'Error en el registro');
            }
        } catch (error) {
            showToast(error.message || 'Error de registro', 'error');
        } finally {
            setLoadingState('register', false);
        }
    }

    function setLoadingState(form, loading) {
        const button = document.getElementById(`${form}ButtonText`);
        const spinner = document.getElementById(`${form}Loading`);

        if (loading) {
            button.style.display = 'none';
            spinner.classList.remove('hidden');
        } else {
            button.style.display = 'inline';
            spinner.classList.add('hidden');
        }
    }

    function logout() {
        currentUser = null;
        localStorage.removeItem('currentUser');
        document.getElementById('navMenu').style.display = 'none';
        document.getElementById('userInfo').style.display = 'none';
        showAuthModal();
    }

    function showDashboard() {
        hideAllViews();
        document.getElementById('dashboard').classList.add('active');
        loadDashboardData();

        // Desconectar WebSocket cuando se sale de la vista de pelea
        if (liveWebSocket) {
            liveWebSocket.disconnect();
        }
    }

    function showEvents() {
        showDashboard(); // For now, same as dashboard
    }

    async function showFights() {
        hideAllViews();
        document.getElementById('liveFight').classList.add('active');

        try {
            // Verificar si hay peleas en vivo
            const response = await fetch(`${API_BASE}/peleas`, {
                headers: {
                    'Authorization': `Basic ${currentUser.credentials}`,
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                const peleas = await response.json();
                const peleasEnVivo = peleas.filter(p => !p.finalizada);

                if (peleasEnVivo.length === 0) {
                    // No hay peleas en vivo - mostrar mensaje
                    showNoLiveFightsMessage();
                    return;
                }

                // Hay peleas en vivo - cargar la primera
                const pelea = peleasEnVivo[0];
                await displayFightInfo(pelea);

                // Conectar WebSocket solo si hay peleas en vivo
                if (!liveWebSocket) {
                    liveWebSocket = new LiveFightWebSocket();
                }
                liveWebSocket.connect();
            } else {
                throw new Error('Error cargando peleas');
            }
        } catch (error) {
            console.error('Error cargando peleas:', error);
            showNoLiveFightsMessage();
        }
    }

    function showNoLiveFightsMessage() {
        const liveFightContainer = document.getElementById('liveFight');
        liveFightContainer.innerHTML = `
        <div style="text-align: center; padding: 4rem 2rem; color: #cccccc;">
            <button class="btn btn-secondary" onclick="showDashboard()" style="float: left; margin-bottom: 2rem;">
                <i class="fas fa-arrow-left"></i> Volver
            </button>
            <div style="clear: both;"></div>

            <div style="background: linear-gradient(145deg, #1a1f2e, #2d1b2e); padding: 3rem; border-radius: 20px; border: 2px solid #404040; max-width: 600px; margin: 0 auto;">
                <i class="fas fa-video-slash" style="font-size: 4rem; color: #666; margin-bottom: 2rem;"></i>
                <h2 style="color: #d32f2f; margin-bottom: 1rem; font-size: 2rem;">No hay peleas en vivo</h2>
                <p style="font-size: 1.2rem; margin-bottom: 2rem; line-height: 1.6;">
                    Actualmente no hay peleas transmitiendo en tiempo real.
                </p>
                <div style="background: rgba(211, 47, 47, 0.1); padding: 1.5rem; border-radius: 10px; border-left: 4px solid #d32f2f; margin-bottom: 2rem;">
                    <h4 style="color: #d32f2f; margin-bottom: 0.5rem;">
                        <i class="fas fa-info-circle"></i> ¿Qué puedes hacer?
                    </h4>
                    <ul style="text-align: left; list-style: none; padding: 0;">
                        <li style="margin: 0.5rem 0;"><i class="fas fa-calendar" style="color: #d32f2f; margin-right: 0.5rem;"></i> Revisar próximos eventos</li>
                        <li style="margin: 0.5rem 0;"><i class="fas fa-plus" style="color: #d32f2f; margin-right: 0.5rem;"></i> Crear nuevas peleas (solo admins)</li>
                        <li style="margin: 0.5rem 0;"><i class="fas fa-sync" style="color: #d32f2f; margin-right: 0.5rem;"></i> Actualizar para verificar nuevas peleas</li>
                    </ul>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button class="btn" onclick="showDashboard()">
                        <i class="fas fa-home"></i> Ir al Dashboard
                    </button>
                    <button class="btn btn-secondary" onclick="refreshData()">
                        <i class="fas fa-sync"></i> Actualizar
                    </button>
                </div>
            </div>
        </div>
    `;

        // Desconectar WebSocket si está conectado
        if (liveWebSocket) {
            liveWebSocket.disconnect();
        }
    }


    async function loadCurrentFight() {
        try {
            // Obtener peleas no finalizadas
            const response = await fetch(`${API_BASE}/peleas`, {
                headers: {
                    'Authorization': `Basic ${currentUser.credentials}`,
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                const peleas = await response.json();
                const peleasEnVivo = peleas.filter(p => !p.finalizada);

                if (peleasEnVivo.length > 0) {
                    // Tomar la primera pelea en vivo
                    const pelea = peleasEnVivo[0];
                    await displayFightInfo(pelea);
                } else {
                    // No hay peleas en vivo
                    document.querySelector('.fight-title').textContent = 'No hay peleas en vivo';
                    document.querySelector('.fight-status').textContent = 'Sin peleas activas';
                    document.querySelector('.fight-status').className = 'fight-status status-finished';
                }
            }
        } catch (error) {
            console.error('Error cargando pelea actual:', error);
            showToast('Error cargando información de la pelea', 'error');
        }
    }

    async function displayFightInfo(pelea) {
        try {
            // Cargar información del evento
            const eventoResponse = await fetch(`${API_BASE}/eventos/${pelea.eventoId}`, {
                headers: {
                    'Authorization': `Basic ${currentUser.credentials}`,
                    'Content-Type': 'application/json'
                }
            });
            const evento = await eventoResponse.json();

            // Cargar información de los luchadores
            const [luchadorAzulResponse, luchadorRojoResponse] = await Promise.all([
                fetch(`${API_BASE}/luchadores/${pelea.luchadorAzulId}`, {
                    headers: {
                        'Authorization': `Basic ${currentUser.credentials}`,
                        'Content-Type': 'application/json'
                    }
                }),
                fetch(`${API_BASE}/luchadores/${pelea.luchadorRojoId}`, {
                    headers: {
                        'Authorization': `Basic ${currentUser.credentials}`,
                        'Content-Type': 'application/json'
                    }
                })
            ]);

            const luchadorAzul = await luchadorAzulResponse.json();
            const luchadorRojo = await luchadorRojoResponse.json();

            // Actualizar la UI con datos reales
            document.querySelector('.fight-title').textContent = `${evento.nombre} - Pelea Principal`;

            // Actualizar luchador azul
            document.querySelector('.fighters-vs .fighter-card:first-child .fighter-name').textContent = luchadorAzul.nombre;
            document.querySelector('.fighters-vs .fighter-card:first-child .fighter-record').textContent =
                `${luchadorAzul.nacionalidad || 'Internacional'} - ${luchadorAzul.edad || '?'} años`;

            // Actualizar luchador rojo
            document.querySelector('.fighters-vs .fighter-card:last-child .fighter-name').textContent = luchadorRojo.nombre;
            document.querySelector('.fighters-vs .fighter-card:last-child .fighter-record').textContent =
                `${luchadorRojo.nacionalidad || 'Internacional'} - ${luchadorRojo.edad || '?'} años`;

            // Cargar estadísticas reales
            await loadFightStatistics(pelea.id, pelea.luchadorAzulId, pelea.luchadorRojoId);

        } catch (error) {
            console.error('Error mostrando información de la pelea:', error);
        }
    }

    async function loadFightsForEvent(eventoId) {
        try {
            const response = await fetch(`${API_BASE}/peleas/evento/${eventoId}`, {
                headers: {
                    'Authorization': `Basic ${currentUser.credentials}`,
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                return await response.json();
            }
            return [];
        } catch (error) {
            console.error('Error cargando peleas del evento:', error);
            return [];
        }
    }

    async function loadFightStatistics(peleaId, luchadorAzulId, luchadorRojoId) {
        try {
            // Cargar estadísticas desde la API
            const statsResponse = await fetch(`${API_BASE}/estadisticas`, {
                headers: {
                    'Authorization': `Basic ${currentUser.credentials}`,
                    'Content-Type': 'application/json'
                }
            });

            if (statsResponse.ok) {
                const todasEstadisticas = await statsResponse.json();

                // Filtrar estadísticas de esta pelea
                const statsAzul = todasEstadisticas.filter(s =>
                    s.peleaId === peleaId && s.luchadorId === luchadorAzulId);
                const statsRojo = todasEstadisticas.filter(s =>
                    s.peleaId === peleaId && s.luchadorId === luchadorRojoId);

                // Calcular totales
                const totalesAzul = calcularTotales(statsAzul);
                const totalesRojo = calcularTotales(statsRojo);

                // Actualizar UI con datos reales
                updateStatsDisplay(totalesAzul, totalesRojo);

                // Cargar probabilidades
                await loadProbabilities(peleaId, luchadorAzulId, luchadorRojoId);
            }
        } catch (error) {
            console.error('Error cargando estadísticas:', error);
        }
    }

    function calcularTotales(estadisticas) {
        return {
            golpes: estadisticas.reduce((sum, s) => sum + (s.golpesConectados || 0), 0),
            derribos: estadisticas.reduce((sum, s) => sum + (s.derribos || 0), 0),
            controlJaula: estadisticas.reduce((sum, s) => sum + (s.controlJaulaSegundos || 0), 0),
            round: estadisticas.length > 0 ? Math.max(...estadisticas.map(s => s.round || 1)) : 1
        };
    }

    function updateStatsDisplay(totalesAzul, totalesRojo) {
        // Actualizar golpes
        document.querySelector('.stat-row:nth-child(1) .stat-blue').textContent = totalesAzul.golpes;
        document.querySelector('.stat-row:nth-child(1) .stat-red').textContent = totalesRojo.golpes;

        // Actualizar derribos
        document.querySelector('.stat-row:nth-child(2) .stat-blue').textContent = totalesAzul.derribos;
        document.querySelector('.stat-row:nth-child(2) .stat-red').textContent = totalesRojo.derribos;

        // Actualizar control de jaula
        document.querySelector('.stat-row:nth-child(3) .stat-blue').textContent = formatTime(totalesAzul.controlJaula);
        document.querySelector('.stat-row:nth-child(3) .stat-red').textContent = formatTime(totalesRojo.controlJaula);

        // Actualizar round actual
        const currentRound = Math.max(totalesAzul.round, totalesRojo.round);
        document.querySelector('.fight-status').textContent = `🔴 EN VIVO - Round ${currentRound}`;
    }

    async function loadProbabilities(peleaId, luchadorAzulId, luchadorRojoId) {
        try {
            const probResponse = await fetch(`${API_BASE}/probabilidades`, {
                headers: {
                    'Authorization': `Basic ${currentUser.credentials}`,
                    'Content-Type': 'application/json'
                }
            });

            if (probResponse.ok) {
                const todasProbabilidades = await probResponse.json();

                // Filtrar probabilidades de esta pelea
                const probAzul = todasProbabilidades
                    .filter(p => p.peleaId === peleaId && p.luchadorId === luchadorAzulId)
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))[0];

                const probRojo = todasProbabilidades
                    .filter(p => p.peleaId === peleaId && p.luchadorId === luchadorRojoId)
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))[0];

                let blueProbability = 50;
                let redProbability = 50;

                if (probAzul && probRojo) {
                    blueProbability = Math.round(probAzul.probabilidad);
                    redProbability = Math.round(probRojo.probabilidad);
                } else {
                    // Si no hay probabilidades, calcular basadas en estadísticas
                    const statsResponse = await fetch(`${API_BASE}/estadisticas`, {
                        headers: {
                            'Authorization': `Basic ${currentUser.credentials}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (statsResponse.ok) {
                        const stats = await statsResponse.json();
                        const statsAzul = stats.filter(s => s.peleaId === peleaId && s.luchadorId === luchadorAzulId);
                        const statsRojo = stats.filter(s => s.peleaId === peleaId && s.luchadorId === luchadorRojoId);

                        const totalesAzul = calcularTotales(statsAzul);
                        const totalesRojo = calcularTotales(statsRojo);

                        // Cálculo simple de probabilidad basado en rendimiento
                        const scoreAzul = totalesAzul.golpes + (totalesAzul.derribos * 5) + (totalesAzul.controlJaula / 60);
                        const scoreRojo = totalesRojo.golpes + (totalesRojo.derribos * 5) + (totalesRojo.controlJaula / 60);
                        const total = scoreAzul + scoreRojo;

                        if (total > 0) {
                            blueProbability = Math.round((scoreAzul / total) * 100);
                            redProbability = 100 - blueProbability;
                        }
                    }
                }

                // Actualizar UI
                document.querySelector('.prob-values .stat-blue').textContent = `${blueProbability}%`;
                document.querySelector('.prob-values .stat-red').textContent = `${redProbability}%`;
                document.querySelector('.prob-blue').style.width = `${blueProbability}%`;
                document.querySelector('.prob-red').style.width = `${redProbability}%`;
            }
        } catch (error) {
            console.error('Error cargando probabilidades:', error);
        }
    }

    function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    function hideAllViews() {
        document.getElementById('dashboard').classList.remove('active');
        document.getElementById('liveFight').classList.remove('active');
    }

    async function loadDashboardData() {
        if (!currentUser) return;

        try {
            // Load stats
            await Promise.all([
                loadEvents(),
                loadFighters(),
                loadStats()
            ]);
        } catch (error) {
            console.error('Error loading dashboard data:', error);
            showToast('Error cargando datos', 'error');
        }
    }

    async function loadEvents() {
        try {
            const response = await fetch(`${API_BASE}/eventos`, {
                headers: {
                    'Authorization': `Basic ${currentUser.credentials}`,
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                const eventos = await response.json();
                document.getElementById('totalEvents').textContent = eventos.length;
                renderEvents(eventos);
            } else {
                throw new Error('Error cargando eventos');
            }
        } catch (error) {
            console.error('Error loading events:', error);
            document.getElementById('totalEvents').textContent = '0';
            renderEvents([]);
        }
    }

    async function loadFighters() {
        try {
            const response = await fetch(`${API_BASE}/luchadores`, {
                headers: {
                    'Authorization': `Basic ${currentUser.credentials}`,
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                const luchadores = await response.json();
                document.getElementById('totalFighters').textContent = luchadores.length;
            } else {
                throw new Error('Error cargando luchadores');
            }
        } catch (error) {
            console.error('Error loading fighters:', error);
            document.getElementById('totalFighters').textContent = '0';
        }
    }

    async function loadStats() {
        try {
            // Usar el nuevo endpoint para peleas en vivo
            const liveFightsResponse = await fetch(`${API_BASE}/peleas/live`, {
                headers: {
                    'Authorization': `Basic ${currentUser.credentials}`,
                    'Content-Type': 'application/json'
                }
            });

            // Usar el nuevo endpoint para peleas finalizadas
            const finishedFightsResponse = await fetch(`${API_BASE}/peleas/finished`, {
                headers: {
                    'Authorization': `Basic ${currentUser.credentials}`,
                    'Content-Type': 'application/json'
                }
            });

            if (liveFightsResponse.ok && finishedFightsResponse.ok) {
                const liveFights = await liveFightsResponse.json();
                const finishedFights = await finishedFightsResponse.json();

                document.getElementById('liveFights').textContent = liveFights.length;
                document.getElementById('completedFights').textContent = finishedFights.length;
            } else {
                throw new Error('Error cargando estadísticas de peleas');
            }
        } catch (error) {
            console.error('Error loading fight stats:', error);
            document.getElementById('liveFights').textContent = '0';
            document.getElementById('completedFights').textContent = '0';
        }
    }

    function renderEvents(eventos) {
        const eventsGrid = document.getElementById('eventsGrid');

        if (eventos.length === 0) {
            eventsGrid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #cccccc;">
                        <i class="fas fa-calendar-times" style="font-size: 3rem; margin-bottom: 1rem; color: #666;"></i>
                        <h3>No hay eventos disponibles</h3>
                        <p>Crea tu primer evento para comenzar</p>
                        <button class="btn" onclick="createEvent()" style="margin-top: 1rem;">
                            <i class="fas fa-plus"></i> Crear Evento
                        </button>
                    </div>
                `;
            return;
        }

        eventsGrid.innerHTML = eventos.map(evento => `
                <div class="event-card">
                    <div class="event-header">
                        <h3>${evento.nombre}</h3>
                        <div class="event-date">
                            <i class="fas fa-calendar"></i>
                            ${formatDate(evento.fecha)}
                        </div>
                    </div>
                    <div class="event-body">
                        <div class="event-location">
                            <i class="fas fa-map-marker-alt"></i>
                            ${evento.ubicacion || 'Ubicación por definir'}
                        </div>
                        <div class="fights-preview">
                            <h4><i class="fas fa-fist-raised"></i> Peleas</h4>
                            <div class="fight-item">
                                <div class="fighters">
                                    <span class="fighter">Cargando peleas...</span>
                                </div>
                                <span class="fight-status status-upcoming">Próximamente</span>
                            </div>
                        </div>
                        <div class="event-actions">
                            <button class="btn" onclick="viewEvent(${evento.id})">
                                <i class="fas fa-eye"></i> Ver Evento
                            </button>
                            <button class="btn btn-secondary" onclick="editEvent(${evento.id})">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
    }

    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('es-ES', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    }

    function viewEvent(eventId) {
        showToast(`Viendo evento ID: ${eventId}`, 'success');
        // Here you would load the specific event details
    }

    function editEvent(eventId) {
        if (currentUser.rol !== 'admin') {
            showToast('Solo los administradores pueden editar eventos', 'error');
            return;
        }
        showToast(`Editando evento ID: ${eventId}`, 'success');
        // Here you would open an edit modal or form
    }

    function createEvent() {
        if (currentUser.rol !== 'admin') {
            showToast('Solo los administradores pueden crear eventos', 'error');
            return;
        }

        const name = prompt('Nombre del evento:');
        const location = prompt('Ubicación:');
        const date = prompt('Fecha (YYYY-MM-DD):');

        if (name && location && date) {
            createEventAPI(name, location, date);
        }
    }

    async function createEventAPI(nombre, ubicacion, fecha) {
        try {
            const response = await fetch(`${API_BASE}/eventos`, {
                method: 'POST',
                headers: {
                    'Authorization': `Basic ${currentUser.credentials}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    nombre: nombre,
                    ubicacion: ubicacion,
                    fecha: fecha
                })
            });

            if (response.ok) {
                showToast('Evento creado exitosamente', 'success');
                loadEvents(); // Reload events
            } else {
                throw new Error('Error creando evento');
            }
        } catch (error) {
            showToast('Error creando evento', 'error');
        }
    }

    function refreshData() {
        showToast('Actualizando datos...', 'success');
        loadDashboardData();
    }

    function showToast(message, type = 'success') {
        // Remove existing toasts
        const existingToast = document.querySelector('.toast');
        if (existingToast) {
            existingToast.remove();
        }

        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;

        document.body.appendChild(toast);

        // Show toast
        setTimeout(() => toast.classList.add('show'), 100);

        // Hide toast after 3 seconds
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    // WebSocket Live Fight Tracker
    class LiveFightWebSocket {
        constructor() {
            this.ws = null;
            this.reconnectAttempts = 0;
            this.maxReconnectAttempts = 5;
            this.reconnectDelay = 2000;
            this.isConnected = false;
        }

        connect() {
            try {
                this.ws = new WebSocket('ws://localhost:8080/live-fight');

                this.ws.onopen = (event) => {
                    console.log('🔴 WebSocket conectado');
                    this.isConnected = true;
                    this.reconnectAttempts = 0;
                    // Solo mostrar mensaje de éxito si es necesario
                    // this.showConnectionStatus('Conectado en tiempo real', 'success');
                };

                this.ws.onmessage = (event) => {
                    try {
                        const message = JSON.parse(event.data);
                        this.handleMessage(message);
                    } catch (error) {
                        console.error('Error parseando mensaje:', error);
                    }
                };

                this.ws.onclose = (event) => {
                    console.log('❌ WebSocket desconectado:', event.code, event.reason);
                    this.isConnected = false;
                    // Comentado para evitar mensaje molesto al desconectar
                    // this.showConnectionStatus('Desconectado', 'error');
                    this.attemptReconnect();
                };

                this.ws.onerror = (error) => {
                    console.error('🚫 Error WebSocket:', error);
                    // Comentado para evitar mensaje molesto de error
                    // this.showConnectionStatus('Error de conexión', 'error');
                };

            } catch (error) {
                console.error('Error creando WebSocket:', error);
                this.attemptReconnect();
            }
        }

        handleMessage(message) {
            console.log('📨 Mensaje recibido:', message);

            switch (message.type) {
                case 'welcome':
                    console.log('👋 Bienvenida:', message.data);
                    showToast('Conectado a transmisión en vivo', 'success');
                    break;

                case 'fight-stats':
                    // Por ahora ignoramos las actualizaciones aleatorias del WebSocket
                    // this.updateFightStats(message.data);
                    console.log('Actualización de estadísticas recibida (ignorada por ahora)');
                    break;

                default:
                    console.log('Mensaje no reconocido:', message);
            }
        }

        updateFightStats(stats) {
            // Actualizar estadísticas en la UI
            const elements = {
                blueStrikes: document.querySelector('.stat-row:nth-child(1) .stat-blue'),
                redStrikes: document.querySelector('.stat-row:nth-child(1) .stat-red'),
                blueTakedowns: document.querySelector('.stat-row:nth-child(2) .stat-blue'),
                redTakedowns: document.querySelector('.stat-row:nth-child(2) .stat-red'),
                blueCageControl: document.querySelector('.stat-row:nth-child(3) .stat-blue'),
                redCageControl: document.querySelector('.stat-row:nth-child(3) .stat-red'),
                currentRound: document.querySelector('.fight-status'),
                blueProbability: document.querySelector('.prob-values .stat-blue'),
                redProbability: document.querySelector('.prob-values .stat-red'),
                probBlueBar: document.querySelector('.prob-blue'),
                probRedBar: document.querySelector('.prob-red')
            };

            if (elements.blueStrikes) elements.blueStrikes.textContent = stats.blueStrikes;
            if (elements.redStrikes) elements.redStrikes.textContent = stats.redStrikes;
            if (elements.blueTakedowns) elements.blueTakedowns.textContent = stats.blueTakedowns;
            if (elements.redTakedowns) elements.redTakedowns.textContent = stats.redTakedowns;
            if (elements.blueCageControl) elements.blueCageControl.textContent = this.formatTime(stats.blueCageControl);
            if (elements.redCageControl) elements.redCageControl.textContent = this.formatTime(stats.redCageControl);
            if (elements.currentRound) elements.currentRound.textContent = `🔴 EN VIVO - Round ${stats.currentRound} (${stats.timeRemaining})`;
            if (elements.blueProbability) elements.blueProbability.textContent = `${stats.blueProbability}%`;
            if (elements.redProbability) elements.redProbability.textContent = `${stats.redProbability}%`;
            if (elements.probBlueBar) elements.probBlueBar.style.width = `${stats.blueProbability}%`;
            if (elements.probRedBar) elements.probRedBar.style.width = `${stats.redProbability}%`;

            const timestamp = document.querySelector('.probability-panel p');
            if (timestamp) {
                timestamp.textContent = 'Actualizado ahora mismo';
            }

            this.addUpdateEffect();
        }

        formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        addUpdateEffect() {
            const panels = document.querySelectorAll('.stats-panel, .probability-panel');
            panels.forEach(panel => {
                panel.style.transform = 'scale(1.02)';
                panel.style.transition = 'transform 0.2s ease';
                setTimeout(() => {
                    panel.style.transform = 'scale(1)';
                }, 200);
            });
        }

        showConnectionStatus(message, type) {
            const existingStatus = document.querySelector('.connection-status');
            if (existingStatus) {
                existingStatus.remove();
            }

            const status = document.createElement('div');
            status.className = `connection-status ${type}`;
            status.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    padding: 0.5rem 1rem;
                    border-radius: 5px;
                    color: white;
                    font-size: 0.9rem;
                    z-index: 4000;
                    background: ${type === 'success' ? '#4caf50' : '#f44336'};
                    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
                    transform: translateX(300px);
                    transition: transform 0.3s ease;
                `;
            status.innerHTML = `🌐 ${message}`;

            document.body.appendChild(status);

            setTimeout(() => {
                status.style.transform = 'translateX(0)';
            }, 100);

            setTimeout(() => {
                status.style.transform = 'translateX(300px)';
                setTimeout(() => {
                    if (status.parentNode) {
                        status.remove();
                    }
                }, 300);
            }, 3000);
        }

        attemptReconnect() {
            if (this.reconnectAttempts < this.maxReconnectAttempts) {
                this.reconnectAttempts++;
                console.log(`🔄 Reintentando conexión (${this.reconnectAttempts}/${this.maxReconnectAttempts})...`);

                setTimeout(() => {
                    this.connect();
                }, this.reconnectDelay);

                this.reconnectDelay = Math.min(this.reconnectDelay * 1.5, 10000);
            } else {
                console.log('❌ Máximo de reintentos alcanzado');
                // Comentado para evitar mensaje molesto
                // this.showConnectionStatus('Sin conexión - Refresca la página', 'error');
            }
        }

        disconnect() {
            if (this.ws) {
                this.ws.close();
                this.ws = null;
                this.isConnected = false;
            }
        }

        sendMessage(message) {
            if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                this.ws.send(JSON.stringify(message));
            } else {
                console.warn('WebSocket no conectado');
            }
        }

        requestUpdate() {
            this.sendMessage('request_update');
        }
    }

    let liveWebSocket = null;

    // Desconectar cuando se cierra la página
    window.addEventListener('beforeunload', () => {
        if (liveWebSocket) {
            liveWebSocket.disconnect();
        }
    });

    // Función para forzar actualización manual
    function forceUpdate() {
        if (liveWebSocket && liveWebSocket.isConnected) {
            liveWebSocket.requestUpdate();
            showToast('Solicitando actualización...', 'success');
        } else {
            showToast('No hay conexión WebSocket', 'error');
        }
    }
</script>
</body>
</html>
